<div class="container my-5">
  <h2 class="mb-4 text-center font-staatliches section-title1-primary">Order Management</h2>

  <%# Navegación del Dashboard unificada %>
  <div class="d-flex flex-wrap justify-content-center gap-2 mb-4">
    <%= link_to 'Orders', orders_path, class: 'btn btn-primary-custom font-staatliches active' %>
    <%= link_to 'Products', products_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Bookings', bookings_list_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Messages', contacts_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Reviews', reviews_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Clients', clients_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Services', services_path, class: 'btn btn-primary-custom font-staatliches' %>
    <%= link_to 'Stripe Dashboard', "https://dashboard.stripe.com/", class: 'btn btn-primary-custom font-staatliches', target: "_blank" %>
  </div>

  <% if notice.present? %>
    <div class="alert alert-success font-staatliches text-center shadow-sm"><%= notice %></div>
  <% end %>

  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-0">
      <% if @orders.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-dark font-staatliches">
              <tr>
                <th scope="col" class="ps-4">ORDER ID</th>
                <th scope="col">CUSTOMER</th>
                <th scope="col">TOTAL</th>
                <th scope="col" class="text-center">STATUS</th>
                <th scope="col">DATE</th>
                <th scope="col" class="text-center pe-4">ACTIONS</th>
              </tr>
            </thead>
            <tbody class="font-staatliches">
              <% @orders.each do |order| %>
                <tr>
                  <%# ID con estilo de enlace %>
                  <td class="ps-4">
                    <%= link_to "##{order.id}", order_path(order), class: 'fw-bold text-decoration-none text-primary' %>
                  </td>
                  
                  <%# Info del Cliente %>
                  <td>
                    <div class="d-flex flex-column">
                      <span class="fw-bold"><%= order.customer_name %></span>
                      <small class="text-muted" style="font-size: 0.8rem;"><%= order.customer_email %></small>
                    </div>
                  </td>
                  
                  <%# Total con formato moneda local %>
                  <td class="fw-bold text-success">
                    Bs. <%= number_to_currency(order.total, precision: 2, unit: '') %>
                  </td>
                  
                  <%# Estado con Badges personalizados %>
                  <td class="text-center">
                    <% status_class = case order.status
                         when "Recently created" then 'bg-warning text-dark'
                         when "Preparing order" then 'bg-info text-white'
                         when "Shipped" then 'bg-primary'
                         when "Delivered" then 'bg-success'
                         when "Cancelled" then 'bg-danger'
                         else 'bg-secondary'
                       end %>
                    <span class="badge <%= status_class %> rounded-pill px-3 py-2" style="font-size: 0.75rem;">
                      <%= order.status.upcase %>
                    </span><br>
                    <%= "Tracking code: " + order.shipping_code.to_s unless order.shipping_code.nil? %>
                  </td>
                  
                  <%# Fecha formateada %>
                  <td>
                    <small class="text-muted"><%= order.created_at.strftime("%b %d, %Y") %></small>
                  </td>
                  
                  <%# Botones de Acción / Workflow %>
                  <td class="text-center pe-4">
                    <div class="btn-group btn-group-sm shadow-sm" role="group">
                      <%= link_to "#", class: 'btn btn-outline-dark', title: "View Details" do %>
                        <i class="bi bi-eye"></i>
                      <% end %>

                      <% if order.status == "Recently created" %>
                        <%= button_to prepare_order_order_path(order), method: :post, class: "btn btn-outline-info" do %>
                          <i class="bi bi-fire"></i>
                        <% end %>
                      <% end %>

                      <% if order.status == "Preparing order" %>
                        <%= link_to edit_order_path(order), method: :get, class: "btn btn-outline-primary" do %>
                          <i class="bi bi-truck"></i>
                        <% end %>
                      <% end %>

                      <% if order.status == "Shipped" %>
                        <%= button_to delivered_order_path(order), method: :post, class: "btn btn-outline-success" do %>
                          <i class="bi bi-check-circle-fill"></i>
                        <% end %>
                      <% end %>

                      <%# Botón de Cancelar %>
                      <% if ["Shipped", "Delivered", "Cancelled"].exclude?(order.status) %>
                        <%= button_to mark_as_cancelled_order_path(order), method: :post, class: "btn btn-outline-danger", data: { confirm: "Are you sure?" } do %>
                          <i class="bi bi-x-lg"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info m-4 text-center py-5 font-jaro">
          <i class="bi bi-inbox fs-1 d-block mb-3"></i>
          No orders registered yet.
        </div>
      <% end %>
    </div>
  </div>
</div>